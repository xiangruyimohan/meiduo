import jsonfrom urllib.parse import urlencodeimport requestsfrom itsdangerous import TimedJSONWebSignatureSerializer as Serializerfrom django.conf import settingsfrom itsdangerous import BadDatadef generate_save_user_token(openid):    """对openid进行加密"""    # 1.创建序列化器对象    serializer = Serializer(settings.SECRET_KEY, 600)    data = {'openid': openid}    # 2.调用序列化器的dumps    access_token_bytes = serializer.dumps(data)    # 3.把加密后的openid返回    return access_token_bytes.decode()def check_save_user_token(openid):    """对加密的openid进行解密"""    # 1.创建序列化器对象    serializer = Serializer(settings.SECRET_KEY, 600)    try:        # 2.调用loads方法对数据进行解密        data = serializer.loads(openid)    except BadData:        return None    else:        return data.get('openid')class OAuthWeibo(object):    """微博认证sdk"""    def __init__(self,client_id = None, client_secret = None, redirect_uri = None, state=None):        # 用于保存登录成功后的跳转页面路径        self.client_id = client_id        self.redirect_uri = redirect_uri        self.client_secret = client_secret        self.state = state    def get_weibo_url(self):        """        获取微博的验证页面链接        :return:        """        # 微博登录url参数组建        data_dict = {            'client_id':self.client_id,            'redirect_uri':self.redirect_uri,            'state':self.state        }        # 构建url        # urlencode 将query字典转换为url路径中的查询字符        weibo_url = 'https://api.weibo.com/oauth2/authorize?' + urlencode(data_dict)        return weibo_url    # 获取access_token值    def get_access_token(self, code):        # 构建参数数据        data_dict = {            "client_id":self.client_id,            "client_secret":self.client_secret,            "grant_type":"authorization_code",            "redirect_uri":self.redirect_uri,            "code":code        }        # 构建url        url = "https://api.weibo.com/oauth2/access_token"        try:            # POST方式拿去access_token            response = requests.post(url=url,data=data_dict)            """            提取数据            {                'access_token':'asdjkljg',                "expires_in": 3600,     # 生命周期 单位:秒                "remind_in": 3600   # 生命周期            }            """            data = response.text            data_dict = json.loads(data)            access_token = data_dict['access_token']            print(data_dict)        except:            raise Exception('微博请求失败')        return access_token